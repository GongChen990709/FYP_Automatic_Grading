<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script type="text/javascript" src="../../../jquery-3.6.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../common/layui-v2.6.5/layui/css/layui.css"/>
    <script type="text/javascript" src="../common/layui-v2.6.5/layui/layui.js"></script>
    <script type="text/javascript" src="../../js/teacher/GetAssignmentName.js"></script>



    <script>
        layui.use(['layer','form','upload','element'],function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            var upload = layui.upload;
            var element = layui.element;
            var demoListView = $('#demoList1');
            var assignment_id=GetAssignmentID();
            var basepath = "/" + window.location.pathname.split("/")[1];
            var uploadListIns= upload.render({
                elem: '#fileList1',
                url:basepath+"/teacher/pdfUpload?assignment_id="+assignment_id,
                accept:'file',
                exts:'zip|doc|pdf',
                multiple:true,
                auto:false,
                bindAction:'#fileListAction1',
                /*xhr:xhrOnProgress,*/
                progress: function(percent){
                element.progress('demoList', percent + '%'); //执行进度条。n 即为返回的进度百分比
                },
                /*xhr: function(index, e) {
                var percent = e.loaded / e.total;//计算百分比
                percent = parseFloat(percent.toFixed(2));
                element.progress('progress_' + index + '', percent * 100 + '%');
                console.log("-----" + percent);
                },*/
                choose:function (obj) {
                    var files=this.files=obj.pushFile();
                    obj.preview(function(index, file, result){
                        var tr = $(['<tr id="upload-'+ index +'">'
                                       ,'<td>'+ file.name +'</td>'
                                       ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
                                       ,'<td><div class="layui-progress layui-progress-big"  lay-filter="progress_'+ index
                                        +'"><div class="layui-progress-bar" lay-percent=""></div></div></td>'
                                       ,'<td>waiting for uploading</td>'
                                       ,'<td>'
                                       ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
                                       ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                       ,'</td>'
                                       ,'</tr>'].join(''));

                        //单个重传
                        tr.find('.demo-reload').on('click', function(){
                            obj.upload(index, file);
                        });

                        //删除
                        tr.find('.demo-delete').on('click', function(){
                            delete files[index]; //删除对应的文件
                            tr.remove();
                            uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });
                        demoListView.append(tr);
                        element.render('progress'); //渲染新加的进度条组件
                    });
                }

                ,done:function (res,index,upload) {
                    if(res.code==0){
                        layer.msg("success");

                        var tds=$("#upload-"+index).children();
                        tds.eq(3).html('<span style="color: #5FB878;">upload successfully</span>');
                        tds.eq(4).html(''); // 清空操作
                        return delete this.files[index]; // 删除文件队列已经上传成功的文件
                    }
                    this.error(index, upload);
                }
                ,allDone: function(obj){ //多文件上传完毕后的状态回调
                    console.log(obj)
                }
                ,error: function(index, upload){
                    var tr = demoListView.find('tr#upload-'+ index)
                        ,tds = tr.children();
                    tds.eq(3).html('<span style="color: #FF5722;">fail to upload</span>');
                    tds.eq(4).find('.demo-reload').removeClass('layui-hide'); // 显示重传
                }

            })
            
        });
    </script>
</head>

<body>

    <div class="file1">
        Please upload the assignement requirement:
    </div>

    <div class="layui-upload">
        <button type="button" class="layui-btn layui-btn-normal" id="fileList1">Select Files</button>
        <div class="layui-upload-list" style="max-width: 1000px;">
            <table class="layui-table">
                <colgroup>
                    <col>
                    <col width="150">
                    <col width="260">
                    <col width="260">
                    <col width="150">
                </colgroup>
                <thead>
                <tr><th>File Name</th>
                    <th>File Size</th>
                    <th>Upload Progress</th>
                    <th>Situation</th>
                    <th>Operation</th>
                </tr></thead>
                <!--<tbody id="demoList"></tbody>-->
                <tbody class="layui-progress" lay-showpercent="true" lay-filter="demoList" id="demoList1"></tbody>
            </table>
        </div>
        <button type="button" class="layui-btn" id="fileListAction1">Submit</button>
    </div>

    <div class="file1">
        Please upload the sample answer:
    </div>

    <div class="layui-upload">
        <button type="button" class="layui-btn layui-btn-normal" id="fileList2">Select Files</button>
        <div class="layui-upload-list" style="max-width: 1000px;">
            <table class="layui-table">
                <colgroup>
                    <col>
                    <col width="150">
                    <col width="260">
                    <col width="260">
                    <col width="150">
                </colgroup>
                <thead>
                <tr><th>File Name</th>
                    <th>File Size</th>
                    <th>Upload Progress</th>
                    <th>Situation</th>
                    <th>Operation</th>
                </tr></thead>
                <!--<tbody id="demoList"></tbody>-->
                <tbody class="layui-progress" lay-showpercent="true" lay-filter="demoList" id="demoList2"></tbody>
            </table>
        </div>
        <button type="button" class="layui-btn" id="fileListAction2">Submit</button>
    </div>



</body>
</html>